<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ä½œä¸š - æ— éšœç¢AIå­¦ä¹ å¹³å°</title>
    
    <style>
        /* ==================== åŸºç¡€æ ·å¼ ==================== */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --text-primary: #212121;
            --text-secondary: #666666;
            --accent-color: #1a73e8;
            --success-color: #34a853;
            --warning-color: #fbbc04;
            --error-color: #ea4335;
            --border-color: #e0e0e0;
            
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC",
                         "Microsoft YaHei", sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            min-height: 100vh;
        }
        
        /* ==================== é¡¶éƒ¨å¯¼èˆªæ  ==================== */
        .top-nav {
            background-color: var(--accent-color);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .nav-btn {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }
        
        /* ==================== ä¸»å®¹å™¨ ==================== */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-xl) var(--spacing-md);
        }
        
        /* ==================== å¡ç‰‡æ ·å¼ ==================== */
        .card {
            background-color: var(--bg-primary);
            border-radius: 12px;
            padding: var(--spacing-lg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: var(--spacing-lg);
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
        }
        
        /* ==================== è¡¨å•æ ·å¼ ==================== */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-sm);
            font-size: 14px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: border-color 0.2s;
        }
        
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* ==================== æŒ‰é’®æ ·å¼ ==================== */
        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 40px;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1557b0;
        }
        
        /* ==================== æ–‡ä»¶ä¸Šä¼ æ ·å¼ ==================== */
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: var(--spacing-lg);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .file-upload-area:hover {
            border-color: var(--accent-color);
            background-color: rgba(26, 115, 232, 0.05);
        }
        
        .file-input {
            display: none;
        }
        
        .file-preview {
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm);
            background-color: var(--bg-secondary);
            border-radius: 8px;
            font-size: 14px;
        }
        
        /* ==================== ä½œä¸šåˆ—è¡¨æ ·å¼ ==================== */
        .homework-list {
            list-style: none;
        }
        
        .homework-item {
            background-color: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .homework-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }
        
        .homework-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }
        
        .homework-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .homework-link {
            display: inline-block;
            margin-top: var(--spacing-sm);
            color: var(--accent-color);
            text-decoration: none;
        }
        
        .homework-link:hover {
            text-decoration: underline;
        }
        
        
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: var(--spacing-md);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="top-nav">
        <div class="nav-title">ğŸ“ æˆ‘çš„ä½œä¸š</div>
        <button class="nav-btn" id="returnBtn" aria-label="è¿”å›è¯¾ç¨‹é€‰æ‹©é¡µé¢">
            â† è¿”å›
        </button>
    </nav>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- ä½œä¸šåˆ—è¡¨ -->
        <div class="card">
            <h2 class="card-title">ğŸ“‹ å¾…å®Œæˆä½œä¸š</h2>
            <ul class="homework-list" id="homeworkList">
                <!-- ç¤ºä¾‹ä½œä¸š -->
                <li class="homework-item">
                    <h3 class="homework-title">ä½œä¸š1ï¼šä½¿ç”¨AIç”Ÿæˆä¸€å¼ é£æ™¯å›¾ç‰‡</h3>
                    <p class="homework-desc">ä½¿ç”¨AIå›¾åƒç”Ÿæˆå·¥å…·åˆ›å»ºä¸€å¼ é£æ™¯å›¾ç‰‡ï¼Œè¦æ±‚åŒ…å«å±±ã€æ°´ã€å¤©ç©ºç­‰å…ƒç´ ã€‚</p>
                    <p class="homework-meta">æˆªæ­¢æ—¥æœŸï¼š2024-12-31 | çŠ¶æ€ï¼šæœªæäº¤</p>
                    <a href="https://www.midjourney.com" class="homework-link" target="_blank" rel="noopener">
                        ğŸ”— å‰å¾€AIå·¥å…·
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- ä½œä¸šæäº¤è¡¨å• -->
        <div class="card">
            <h2 class="card-title">ğŸ“¤ æäº¤ä½œä¸š</h2>
            <form id="submissionForm">
                <div class="form-group">
                    <label class="form-label" for="homeworkSelect">é€‰æ‹©ä½œä¸š *</label>
                    <select id="homeworkSelect" class="form-input" required>
                        <option value="">è¯·é€‰æ‹©è¦æäº¤çš„ä½œä¸š</option>
                        <option value="1">ä½œä¸š1ï¼šä½¿ç”¨AIç”Ÿæˆä¸€å¼ é£æ™¯å›¾ç‰‡</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="submissionNote">ä½œä¸šè¯´æ˜</label>
                    <textarea id="submissionNote" class="form-textarea" 
                              placeholder="ç®€è¦è¯´æ˜æ‚¨çš„ä½œä¸šå†…å®¹ã€ä½¿ç”¨çš„AIå·¥å…·ã€åˆ›ä½œè¿‡ç¨‹ç­‰..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ä¸Šä¼ ä½œä¸šæ–‡ä»¶ *</label>
                    <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 48px; margin-bottom: 8px;">ğŸ“</div>
                        <div>ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€HTMLç­‰æ ¼å¼ï¼‰</div>
                    </div>
                    <input type="file" id="fileInput" class="file-input" 
                           accept="image/*,video/*,.html,.htm" 
                           onchange="handleFileUpload(this)" required>
                    <div id="filePreview" class="file-preview" style="display:none;"></div>
                </div>
                
                <button type="submit" class="btn btn-primary">æäº¤ä½œä¸š</button>
            </form>
        </div>
    </div>

    <script>
        // ==================== ç”¨æˆ·æ¨¡å¼æ£€æµ‹ ====================
        const urlParams = new URLSearchParams(window.location.search);
        const userMode = urlParams.get('mode') || localStorage.getItem('userMode') || 'visual';
        localStorage.setItem('userMode', userMode);
        
        // ==================== è¿”å›æŒ‰é’®åŠŸèƒ½ ====================
        const returnBtn = document.getElementById('returnBtn');
        returnBtn.addEventListener('click', () => {
            window.location.href = `course_selection.html?mode=${userMode}`;
        });

        // ==================== åŠ¨æ€åŠ è½½ä½œä¸š ====================
        async function loadHomeworkFromAPI() {
            try {
                const response = await fetch('http://localhost:3000/api/homework');
                const result = await response.json();

                if (result.success && result.homework) {
                    const homeworkList = document.getElementById('homeworkList');
                    const homeworkSelect = document.getElementById('homeworkSelect');

                    // æ¸…ç©ºç°æœ‰å†…å®¹
                    homeworkList.innerHTML = '';
                    homeworkSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¦æäº¤çš„ä½œä¸š</option>';

                    // æ¸²æŸ“ä½œä¸šåˆ—è¡¨
                    result.homework.forEach(hw => {
                        renderHomeworkItem(hw, homeworkList);
                        addHomeworkOption(hw, homeworkSelect);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½ä½œä¸šå¤±è´¥:', error);
                // å¦‚æœåç«¯æœªå¯åŠ¨ï¼Œä¿ç•™ç¤ºä¾‹ä½œä¸š
            }
        }

        // æ¸²æŸ“ä½œä¸šé¡¹
        function renderHomeworkItem(homework, container) {
            const li = document.createElement('li');
            li.className = 'homework-item';

            const deadline = homework.deadline ? new Date(homework.deadline).toLocaleDateString('zh-CN') : 'æ— æˆªæ­¢æ—¥æœŸ';
            const aiToolLink = homework.aiToolLinks && homework.aiToolLinks.length > 0
                ? homework.aiToolLinks[0].url
                : '#';
            const aiToolName = homework.aiToolLinks && homework.aiToolLinks.length > 0
                ? homework.aiToolLinks[0].name
                : 'AIå·¥å…·';

            li.innerHTML = `
                <h3 class="homework-title">${homework.title}</h3>
                <p class="homework-desc">${homework.description}</p>
                <p class="homework-meta">æˆªæ­¢æ—¥æœŸï¼š${deadline} | çŠ¶æ€ï¼šæœªæäº¤</p>
                ${aiToolLink !== '#' ? `<a href="${aiToolLink}" class="homework-link" target="_blank" rel="noopener">
                    ğŸ”— å‰å¾€${aiToolName}
                </a>` : ''}
            `;

            container.appendChild(li);
        }

        // æ·»åŠ ä½œä¸šé€‰é¡¹
        function addHomeworkOption(homework, select) {
            const option = document.createElement('option');
            option.value = homework.id;
            option.textContent = homework.title;
            select.appendChild(option);
        }

        // é¡µé¢åŠ è½½æ—¶è·å–ä½œä¸š
        loadHomeworkFromAPI();

        // ==================== æ–‡ä»¶ä¸Šä¼ å¤„ç† ====================
        function handleFileUpload(input) {
            const file = input.files[0];
            const preview = document.getElementById('filePreview');
            
            if (file) {
                preview.style.display = 'block';
                preview.innerHTML = `
                    <strong>å·²é€‰æ‹©æ–‡ä»¶ï¼š</strong> ${file.name}
                    <br><strong>æ–‡ä»¶å¤§å°ï¼š</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB
                `;
            }
        }
        
        // ==================== é€šçŸ¥åŠŸèƒ½ ====================
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'assertive');
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // ==================== è¡¨å•æäº¤ ====================
        document.getElementById('submissionForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const homeworkSelect = document.getElementById('homeworkSelect').value;
            const note = document.getElementById('submissionNote').value;
            const file = document.getElementById('fileInput').files[0];
            
            if (!homeworkSelect || !file) {
                alert('è¯·é€‰æ‹©ä½œä¸šå¹¶ä¸Šä¼ æ–‡ä»¶ï¼');
                return;
            }
            
            // è¿™é‡Œæš‚æ—¶åªæ˜¯æ˜¾ç¤ºæç¤ºï¼Œå®é™…åº”è¯¥å‘é€åˆ°åç«¯
            const message = 'ä½œä¸šæäº¤æˆåŠŸï¼\n\næ³¨æ„ï¼šå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ï¼Œæ•°æ®æœªä¿å­˜åˆ°æœåŠ¡å™¨ã€‚';
            alert(message);
            showNotification('ä½œä¸šæäº¤æˆåŠŸï¼');
            
            // é‡ç½®è¡¨å•
            e.target.reset();
            document.getElementById('filePreview').style.display = 'none';
        });
        
    </script>
</body>
</html>
