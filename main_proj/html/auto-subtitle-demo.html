<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自动字幕生成器 - 使用示例</title>
    <link rel="stylesheet" href="auto-subtitle-generator.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .demo-container {
            background-color: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .demo-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a9d95;
            margin-bottom: 16px;
        }

        .video-wrapper {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto 24px;
        }

        video {
            width: 100%;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 class="demo-title">自动字幕生成器 - 使用示例</h1>
        <p>此示例展示如何使用Web Speech API为视频自动生成字幕。</p>
        <p><strong>注意：</strong>此功能需要Chrome浏览器，并且需要麦克风权限。</p>
    </div>

    <div class="demo-container">
        <h2 class="demo-title">视频播放器</h2>
        <div class="video-wrapper">
            <video id="demoVideo" controls crossorigin="anonymous">
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WhatCarCanYouGetForAGrand.mp4" type="video/mp4">
                您的浏览器不支持视频播放。
            </video>

            <!-- 字幕显示容器 -->
            <div class="auto-subtitle-container">
                <div class="auto-subtitle-text" id="subtitleDisplay"></div>
            </div>
        </div>

        <!-- 字幕控制面板 -->
        <div class="subtitle-control-panel">
            <h3 class="subtitle-control-title">字幕控制</h3>

            <div class="subtitle-control-buttons">
                <button class="subtitle-control-btn" id="startBtn">开始识别</button>
                <button class="subtitle-control-btn" id="stopBtn" disabled>停止识别</button>
                <button class="subtitle-control-btn" id="clearBtn">清空历史</button>
                <button class="subtitle-control-btn" id="exportBtn">导出SRT</button>
            </div>

            <div class="subtitle-language-select">
                <label for="languageSelect">选择语言：</label>
                <select id="languageSelect">
                    <option value="zh-CN">中文（简体）</option>
                    <option value="zh-TW">中文（繁体）</option>
                    <option value="en-US">英语（美国）</option>
                    <option value="en-GB">英语（英国）</option>
                    <option value="ja-JP">日语</option>
                    <option value="ko-KR">韩语</option>
                </select>
            </div>

            <div class="subtitle-status">
                <div class="subtitle-status-indicator" id="statusIndicator"></div>
                <span id="statusText">未启动</span>
            </div>
        </div>

        <!-- 字幕历史记录 -->
        <div class="subtitle-history" id="historyContainer">
            <p style="text-align: center; color: #999;">暂无字幕记录</p>
        </div>
    </div>

    <script src="auto-subtitle-generator.js"></script>
    <script>
        // 初始化
        const videoElement = document.getElementById('demoVideo');
        const subtitleDisplay = document.getElementById('subtitleDisplay');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const exportBtn = document.getElementById('exportBtn');
        const languageSelect = document.getElementById('languageSelect');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const historyContainer = document.getElementById('historyContainer');

        // 创建字幕生成器实例
        const subtitleGenerator = new AutoSubtitleGenerator(videoElement, {
            language: 'zh-CN',
            subtitleContainer: subtitleDisplay,
            onResult: (result) => {
                console.log('识别结果:', result);
                updateHistory();
            },
            onError: (error) => {
                console.error('识别错误:', error);
                alert('语音识别错误: ' + error);
            }
        });

        // 开始识别按钮
        startBtn.addEventListener('click', () => {
            subtitleGenerator.start();
            startBtn.disabled = true;
            stopBtn.disabled = false;
            statusIndicator.classList.add('active');
            statusText.textContent = '识别中...';
        });

        // 停止识别按钮
        stopBtn.addEventListener('click', () => {
            subtitleGenerator.stop();
            startBtn.disabled = false;
            stopBtn.disabled = true;
            statusIndicator.classList.remove('active');
            statusText.textContent = '已停止';
        });

        // 清空历史按钮
        clearBtn.addEventListener('click', () => {
            if (confirm('确定要清空所有字幕历史记录吗？')) {
                subtitleGenerator.clearHistory();
                updateHistory();
            }
        });

        // 导出SRT按钮
        exportBtn.addEventListener('click', () => {
            const srt = subtitleGenerator.exportToSRT();
            if (!srt) {
                alert('暂无字幕记录可导出');
                return;
            }

            // 创建下载链接
            const blob = new Blob([srt], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'subtitles.srt';
            a.click();
            URL.revokeObjectURL(url);
        });

        // 语言选择
        languageSelect.addEventListener('change', (e) => {
            subtitleGenerator.setLanguage(e.target.value);
        });

        // 更新历史记录显示
        function updateHistory() {
            const history = subtitleGenerator.getHistory();
            if (history.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; color: #999;">暂无字幕记录</p>';
                return;
            }

            historyContainer.innerHTML = history.map(item => `
                <div class="subtitle-history-item">
                    <span class="subtitle-history-time">${formatTime(item.timestamp)}</span>
                    <span class="subtitle-history-text">${item.text}</span>
                </div>
            `).join('');
        }

        // 格式化时间
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // 视频播放时自动开始识别
        videoElement.addEventListener('play', () => {
            if (!subtitleGenerator.isRecognizing) {
                startBtn.click();
            }
        });

        // 视频暂停时停止识别
        videoElement.addEventListener('pause', () => {
            if (subtitleGenerator.isRecognizing) {
                stopBtn.click();
            }
        });
    </script>
</body>
</html>
