<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Êó†ÈöúÁ¢çAIÂ≠¶‰π†Âπ≥Âè∞ - ËØæÁ®ãÂ≠¶‰π†">
    <title>Êó†ÈöúÁ¢çAIÂ≠¶‰π†Âπ≥Âè∞ - ËØæÁ®ãÂ≠¶‰π†</title>

    <style>
        /* ==================== Âü∫Á°ÄÊ†∑Âºè ==================== */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --text-primary: #212121;
            --text-secondary: #666666;
            --accent-color: #1a9d95;
            --success-color: #34a853;
            --error-color: #ea4335;
            --border-color: #e0e0e0;
            --user-msg-bg: #e3f2fd;
            --ai-msg-bg: #f1f8e9;

            /* Â≠ó‰ΩìÂ§ßÂ∞è - ÈªòËÆ§Ê≠£Â∏∏Â§ßÂ∞è */
            --font-size-base: 16px;
            --font-scale: 1;

            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
        }

        /* ËßÜÈöúÁî®Êà∑Ê®°Âºè - Â§ßÂ≠ó‰Ωì */
        body.visual-mode {
            --font-scale: 2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC",
                         "Microsoft YaHei", sans-serif;
            font-size: calc(var(--font-size-base) * var(--font-scale));
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ==================== È°∂ÈÉ®Â∑•ÂÖ∑Ê†è - Á∫øÊÄßÂ∏ÉÂ±Ä ==================== */
        .top-toolbar {
            background-color: var(--accent-color);
            color: white;
            padding: var(--spacing-lg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .toolbar-title {
            font-size: calc(20px * var(--font-scale));
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .toolbar-btn {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: calc(16px * var(--font-scale));
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            display: block;
        }

        .toolbar-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }

        .toolbar-btn:focus {
            outline: 3px solid white;
            outline-offset: 2px;
        }

        /* ==================== ËøõÂ∫¶Êù° ==================== */
        .progress-bar-wrapper {
            background-color: rgba(255,255,255,0.2);
            height: 4px;
            width: 100%;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: white;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* ==================== ‰∏ªÂÆπÂô® ==================== */
        .container {
            flex: 1;
            overflow-y: auto;
            max-width: 800px;
            margin: 0 auto;
            padding: var(--spacing-md);
            width: 100%;
        }

        /* ==================== È°µÈù¢Â§¥ÈÉ® ==================== */
        .header {
            text-align: center;
            padding: var(--spacing-lg) 0;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
        }

        .header h1 {
            font-size: calc(28px * var(--font-scale));
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--spacing-sm);
        }

        .header p {
            font-size: calc(16px * var(--font-scale));
            color: var(--text-secondary);
        }

        /* ==================== ËßÜÈ¢ëÊí≠ÊîæÂô®Ê†∑Âºè ==================== */
        .video-section {
            display: none;
            background-color: var(--bg-secondary);
            border: 3px solid var(--accent-color);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .video-section.visible {
            display: block;
        }

        .video-title {
            font-size: calc(20px * var(--font-scale));
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        /* ==================== ËßÜÈ¢ëÈìæÊé•ËæìÂÖ•Ê†∑Âºè ==================== */
        .video-link-input-section {
            background-color: var(--bg-primary);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .video-link-title {
            font-size: calc(16px * var(--font-scale));
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: var(--spacing-sm);
            text-align: center;
        }

        .video-link-input-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .video-link-input {
            width: 100%;
            padding: var(--spacing-md);
            font-size: calc(15px * var(--font-scale));
            font-family: inherit;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: border-color 0.2s;
        }

        .video-link-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(26, 157, 149, 0.1);
        }

        .video-link-load-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: calc(15px * var(--font-scale));
            font-weight: 600;
            color: white;
            background-color: var(--accent-color);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: calc(44px * var(--font-scale));
        }

        .video-link-load-btn:hover,
        .video-link-load-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .video-link-load-btn:active {
            transform: translateY(0);
        }

        .video-link-hint {
            font-size: calc(13px * var(--font-scale));
            color: var(--text-secondary);
            text-align: center;
            margin-top: var(--spacing-xs);
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            background-color: #000000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: var(--spacing-md);
        }

        .video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-controls {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .video-progress-bar {
            width: 100%;
            height: calc(8px * var(--font-scale));
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
        }

        .video-progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.1s linear;
        }

        .video-buttons {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
            flex-wrap: wrap;
        }

        .video-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: calc(14px * var(--font-scale));
            font-weight: 600;
            color: white;
            background-color: var(--accent-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: calc(40px * var(--font-scale));
        }

        .video-btn:hover,
        .video-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .video-time-display {
            text-align: center;
            font-size: calc(14px * var(--font-scale));
            color: var(--text-secondary);
            margin-top: var(--spacing-sm);
        }

        /* ==================== Èü≥ÈáèÊéßÂà∂Ê†∑Âºè ==================== */
        .volume-control {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
            padding: var(--spacing-sm);
            background-color: var(--bg-secondary);
            border-radius: 8px;
        }

        .volume-control label {
            font-size: calc(14px * var(--font-scale));
            color: var(--text-primary);
            font-weight: 600;
        }

        .volume-control input[type="range"] {
            width: 100%;
            height: calc(8px * var(--font-scale));
        }

        /* ==================== ‰ªªÂä°Âç°ÁâáÊ†∑Âºè ==================== */
        /* ==================== ‰ªªÂä°Âç°Áâá - Á∫øÊÄßÂ∏ÉÂ±Ä ==================== */
        .task-card {
            background-color: var(--bg-primary);
            border: 3px solid var(--border-color);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            transition: border-color 0.2s;
        }

        .task-card.active {
            border-color: var(--accent-color);
            box-shadow: 0 2px 8px rgba(26, 157, 149, 0.2);
        }

        .task-card.completed {
            border-color: var(--success-color);
            opacity: 0.8;
        }

        .task-title {
            font-size: calc(20px * var(--font-scale));
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .task-description {
            font-size: calc(16px * var(--font-scale));
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: var(--spacing-md);
        }

        .task-ai-hint {
            font-size: calc(15px * var(--font-scale));
            color: var(--accent-color);
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm);
            background-color: rgba(26, 157, 149, 0.1);
            border-radius: 6px;
        }
        
        .task-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            justify-content: center;
        }

        /* ==================== ‰ªªÂä°Êèê‰∫§Âå∫ÂüüÊ†∑Âºè ==================== */
        .task-submission-area {
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 2px solid var(--border-color);
        }

        .task-submission-label {
            font-size: calc(15px * var(--font-scale));
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            display: block;
        }

        .task-submission-textarea {
            width: 100%;
            min-height: calc(120px * var(--font-scale));
            padding: var(--spacing-md);
            font-size: calc(15px * var(--font-scale));
            font-family: inherit;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            resize: vertical;
            transition: border-color 0.2s;
        }

        .task-submission-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(26, 157, 149, 0.1);
        }

        .task-submit-btn {
            margin-top: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: calc(15px * var(--font-scale));
            font-weight: 600;
            color: white;
            background-color: var(--accent-color);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-submit-btn:hover,
        .task-submit-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .task-status {
            margin-top: var(--spacing-sm);
            padding: var(--spacing-sm);
            font-size: calc(14px * var(--font-scale));
            font-weight: 600;
            border-radius: 6px;
            text-align: center;
        }

        .task-status.completed {
            color: var(--success-color);
            background-color: rgba(76, 175, 80, 0.1);
            border: 2px solid var(--success-color);
        }

        .task-status.pending {
            color: var(--text-secondary);
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
        }

        /* ==================== ÊåâÈíÆÊ†∑Âºè ==================== */
        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: calc(16px * var(--font-scale));
            font-weight: 600;
            border: 2px solid;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: calc(48px * var(--font-scale));
            flex: 1;
            min-width: 120px;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        .btn-primary:hover,
        .btn-primary:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }
        
        .btn-secondary {
            background-color: var(--bg-primary);
            color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .btn-secondary:hover,
        .btn-secondary:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ==================== ÂÆåÊàêËØæÁ®ãÊåâÈíÆÊ†∑Âºè ==================== */
        .complete-course-section {
            display: flex;
            justify-content: center;
            padding: var(--spacing-xl);
            margin-top: var(--spacing-lg);
        }

        .complete-course-btn {
            padding: calc(var(--spacing-md) * 1.5) calc(var(--spacing-xl) * 2);
            font-size: calc(18px * var(--font-scale));
            font-weight: 700;
            color: white;
            background-color: var(--success-color);
            border: 3px solid var(--success-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .complete-course-btn:hover,
        .complete-course-btn:focus {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
            outline: 3px solid var(--success-color);
            outline-offset: 3px;
        }

        .complete-course-btn:active {
            transform: translateY(0);
        }
        
        /* ==================== ËøõÂ∫¶Êù°Ê†∑Âºè ==================== */
        .progress-section {
            margin-bottom: var(--spacing-lg);
        }
        
        .progress-bar-container {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            height: calc(40px * var(--font-scale));
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: calc(16px * var(--font-scale));
        }
        
        .progress-text {
            text-align: center;
            margin-top: var(--spacing-sm);
            font-size: calc(16px * var(--font-scale));
            color: var(--text-secondary);
        }
        
        /* ==================== ÈÄöÁü•Ê†∑Âºè ==================== */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: var(--spacing-md);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.3s;
            font-size: calc(16px * var(--font-scale));
        }
        
        .notification.error {
            background-color: var(--error-color);
        }
        
        .notification.info {
            background-color: var(--accent-color);
        }


        /* ==================== ÂìçÂ∫îÂºèËÆæËÆ° ==================== */
        @media (max-width: 600px) {
            .container {
                padding: var(--spacing-sm);
            }
            
            .task-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        /* ==================== Â≠óÂπïÊéßÂà∂Èù¢ÊùøÊ†∑Âºè ==================== */
        .subtitle-controls {
            background-color: var(--bg-primary);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .subtitle-title {
            font-size: calc(16px * var(--font-scale));
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: var(--spacing-sm);
            text-align: center;
        }

        .subtitle-buttons {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
            margin-bottom: var(--spacing-md);
        }

        .subtitle-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: calc(14px * var(--font-scale));
            font-weight: 600;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: calc(40px * var(--font-scale));
        }

        .subtitle-btn.active {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .subtitle-btn:hover,
        .subtitle-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .subtitle-size-control {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .subtitle-size-control label {
            font-size: calc(14px * var(--font-scale));
            color: var(--text-primary);
            font-weight: 600;
        }

        .subtitle-size-control input[type="range"] {
            width: 100%;
            height: calc(8px * var(--font-scale));
            -webkit-appearance: none;
            appearance: none;
            background: var(--border-color);
            outline: none;
            border-radius: 4px;
        }

        .subtitle-size-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: calc(20px * var(--font-scale));
            height: calc(20px * var(--font-scale));
            background: var(--accent-color);
            cursor: pointer;
            border-radius: 50%;
        }

        .subtitle-size-control input[type="range"]::-moz-range-thumb {
            width: calc(20px * var(--font-scale));
            height: calc(20px * var(--font-scale));
            background: var(--accent-color);
            cursor: pointer;
            border-radius: 50%;
        }

        /* ==================== Â≠óÂπïÁîüÊàêÊéßÂà∂Ê†∑Âºè ==================== */
        .subtitle-generation-control {
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .subtitle-status {
            margin-top: var(--spacing-sm);
            padding: var(--spacing-sm);
            background-color: var(--bg-secondary);
            border-radius: 6px;
            font-size: calc(14px * var(--font-scale));
            color: var(--text-secondary);
        }

        .subtitle-status.active {
            background-color: rgba(26, 157, 149, 0.1);
            color: var(--accent-color);
        }

        .subtitle-status.error {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--error-color);
        }

        /* ==================== ÂÆûÊó∂Â≠óÂπïÊòæÁ§∫Ê†∑Âºè ==================== */
        .realtime-subtitle-display {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-md);
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            min-height: 60px;
        }

        .subtitle-text {
            font-size: calc(18px * var(--font-scale));
            color: white;
            text-align: center;
            line-height: 1.6;
        }

        /* ËßÜÈöúÊ®°Âºè‰∏ãÈöêËóèÂ≠óÂπïÊéßÂà∂ */
        body.visual-mode .subtitle-controls {
            display: none;
        }

        /* ==================== ÊúØËØ≠ÊèêÁ§∫Âå∫ÂüüÊ†∑Âºè ==================== */
        .terms-section {
            background-color: var(--bg-secondary);
            border: 3px solid var(--accent-color);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }

        .terms-title {
            font-size: calc(20px * var(--font-scale));
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .terms-container {
            background-color: var(--bg-primary);
            border-radius: 8px;
            padding: var(--spacing-md);
            min-height: 80px;
        }

        .terms-placeholder {
            font-size: calc(16px * var(--font-scale));
            color: var(--text-secondary);
            text-align: center;
            font-style: italic;
        }

        .term-item {
            background-color: var(--ai-msg-bg);
            border-left: 4px solid var(--accent-color);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border-radius: 8px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .term-name {
            font-size: calc(18px * var(--font-scale));
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .term-definition {
            font-size: calc(16px * var(--font-scale));
            color: var(--text-primary);
            line-height: 1.6;
        }

        .term-speak-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .term-speak-btn:hover,
        .term-speak-btn:focus {
            background-color: var(--success-color);
            transform: scale(1.1);
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* ==================== Âê¨ÈöúÊ®°ÂºèÊ†∑ÂºèË¶ÜÁõñ ==================== */
        body.hearing-mode .top-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-lg);
        }

        body.hearing-mode .toolbar-title {
            font-size: calc(24px * var(--font-scale));
            margin-bottom: 0;
            text-align: left;
        }

        body.hearing-mode .toolbar-btn {
            width: auto;
            max-width: none;
            margin: 0;
            padding: 10px 20px;
            font-size: calc(15px * var(--font-scale));
        }

    </style>
</head>
<body>
    <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è - Á∫øÊÄßÂ∏ÉÂ±Ä -->
    <nav class="top-toolbar" role="navigation" aria-label="ËØæÁ®ãÂØºËà™">
        <h1 class="toolbar-title" id="courseTitle">ËØæÁ®ãÂ≠¶‰π†</h1>
        <button class="toolbar-btn" id="returnBtn" aria-label="ËøîÂõûËØæÁ®ãÈÄâÊã©È°µÈù¢">
            ‚Üê ËøîÂõûËØæÁ®ãÈÄâÊã©
        </button>
    </nav>

    <!-- ‰∏ªÂÆπÂô® -->
    <div class="container">
        <!-- ËøõÂ∫¶ÊåáÁ§∫Âô® -->
        <section class="progress-section" role="region" aria-label="Â≠¶‰π†ËøõÂ∫¶">
            <div class="progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar" id="progressBar" style="width: 0%;">
                    0%
                </div>
            </div>
            <p class="progress-text" id="progressText">Â∑≤ÂÆåÊàê 0/0 ‰∏™‰ªªÂä°</p>
        </section>
        
        <!-- ËØæÁ®ãÂ§¥ÈÉ® -->
        <header class="course-header" role="banner">
            <h1 class="course-title" id="courseTitleMain">Âä†ËΩΩ‰∏≠...</h1>
            <p class="course-description" id="courseDescription">Ê≠£Âú®Âä†ËΩΩËØæÁ®ãÂÜÖÂÆπ...</p>
        </header>

        <!-- ËßÜÈ¢ëÊí≠ÊîæÂô®ÔºàÂ¶ÇÊûúËØæÁ®ãÊúâËßÜÈ¢ëÔºâ -->
        <section class="video-section" id="videoSection" role="region" aria-label="ÊïôÂ≠¶ËßÜÈ¢ë">
            <h2 class="video-title">üìπ ÊïôÂ≠¶ËßÜÈ¢ë</h2>

            <div class="video-container">
                <video class="video-player" id="videoPlayer" controls style="display: block;">
                    <source id="videoSource" src="" type="video/mp4">
                    <track id="videoSubtitle" kind="subtitles" srclang="zh" label="‰∏≠Êñá" default>
                    ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËßÜÈ¢ëÊí≠Êîæ„ÄÇ
                </video>
            </div>

            <div class="video-controls">
                <!-- Â≠óÂπïÊéßÂà∂Èù¢ÊùøÔºà‰ªÖÂê¨ÈöúÊ®°ÂºèÊòæÁ§∫Ôºâ -->
                <div class="subtitle-controls">
                    <h3 class="subtitle-title">Â≠óÂπïÊéßÂà∂</h3>

                    <div class="subtitle-buttons">
                        <button class="subtitle-btn active" id="showSubtitleBtn" aria-label="ÊòæÁ§∫Â≠óÂπï">
                            ÊòæÁ§∫Â≠óÂπï
                        </button>
                        <button class="subtitle-btn" id="hideSubtitleBtn" aria-label="ÈöêËóèÂ≠óÂπï">
                            ÈöêËóèÂ≠óÂπï
                        </button>
                    </div>
                    <div class="subtitle-size-control">
                        <label for="subtitleSizeSlider">Â≠óÂπïÂ§ßÂ∞èÔºö<span id="subtitleSizeValue">24</span>px</label>
                        <input type="range" id="subtitleSizeSlider" min="16" max="40" value="24" step="2">
                    </div>
                </div>
            </div>
        </section>

        <!-- ÊúØËØ≠ÊèêÁ§∫Âå∫Âüü -->
        <section class="terms-section" id="termsSection" role="region" aria-label="ÊúØËØ≠Ëß£Èáä" style="display: none;">
            <h2 class="terms-title">üí° ÊúØËØ≠Ëß£Èáä</h2>
            <div class="terms-container" id="termsContainer">
                <p class="terms-placeholder">ÂΩìÂ≠óÂπï‰∏≠Âá∫Áé∞‰∏ì‰∏öÊúØËØ≠Êó∂ÔºåËøôÈáå‰ºöÊòæÁ§∫Ëß£Èáä</p>
            </div>
        </section>

        <!-- ‰ªªÂä°ÂàóË°® -->
        <section class="task-section" role="region" aria-label="Â≠¶‰π†‰ªªÂä°ÂàóË°®" id="taskSection">
            <!-- ‰ªªÂä°Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
        </section>

        <!-- ÂÆåÊàêËØæÁ®ãÊåâÈíÆ -->
        <div class="complete-course-section" role="region" aria-label="ËØæÁ®ãÂÆåÊàê">
            <button class="complete-course-btn" id="completeCourseBtn" aria-label="ÂÆåÊàêËØæÁ®ãÂπ∂ËøîÂõûËØæÁ®ãÈÄâÊã©È°µÈù¢">
                ‚úì ÂÆåÊàêËØæÁ®ã
            </button>
        </div>
    </div>

    <script>
        // ==================== ÂÖ®Â±ÄÁä∂ÊÄÅÁÆ°ÁêÜ ====================
        const state = {
            courseId: null,
            courseData: null,
            userMode: 'hearing', // ÈªòËÆ§Âê¨ÈöúÊ®°Âºè
            currentTask: 1,
            completedTasks: [],
            fontScale: 1,
            termsData: null, // ÊúØËØ≠Êï∞ÊçÆ
            currentTerms: [] // ÂΩìÂâçÂ≠óÂπï‰∏≠ÁöÑÊúØËØ≠
        };
        
        // ==================== URLÂèÇÊï∞Ëß£Êûê ====================
        const urlParams = new URLSearchParams(window.location.search);
        state.courseId = urlParams.get('courseId');
        state.userMode = urlParams.get('mode') || localStorage.getItem('userMode') || 'hearing';
        localStorage.setItem('userMode', state.userMode);
        
        // ËßÜÈöúÊ®°ÂºèÂ∫îÁî®Â§ßÂ≠ó‰Ωì
        if (state.userMode === 'visual') {
            document.body.classList.add('visual-mode');
            state.fontScale = 1.5;
        } else if (state.userMode === 'hearing') {
            document.body.classList.add('hearing-mode');
        }

        // ==================== ‰ªªÂä°Êèê‰∫§Êï∞ÊçÆÁÆ°ÁêÜ ====================
        // Ëé∑Âèñ‰ªªÂä°Êèê‰∫§Êï∞ÊçÆÁöÑlocalStorageÈîÆÂêç
        function getTaskSubmissionsKey() {
            return 'taskSubmissions';
        }

        // ‰øùÂ≠ò‰ªªÂä°Êèê‰∫§ÂÜÖÂÆπ
        function saveTaskSubmission(courseId, taskId, content) {
            const key = getTaskSubmissionsKey();
            const allSubmissions = JSON.parse(localStorage.getItem(key) || '{}');

            if (!allSubmissions[courseId]) {
                allSubmissions[courseId] = {};
            }

            allSubmissions[courseId][taskId] = {
                content: content,
                submittedAt: new Date().toISOString(),
                completed: content.trim().length > 0
            };

            localStorage.setItem(key, JSON.stringify(allSubmissions));
        }

        // Âä†ËΩΩ‰ªªÂä°Êèê‰∫§ÂÜÖÂÆπ
        function loadTaskSubmission(courseId, taskId) {
            const key = getTaskSubmissionsKey();
            const allSubmissions = JSON.parse(localStorage.getItem(key) || '{}');

            if (allSubmissions[courseId] && allSubmissions[courseId][taskId]) {
                return allSubmissions[courseId][taskId];
            }

            return null;
        }

        // Ê£ÄÊü•‰ªªÂä°ÊòØÂê¶ÂÆåÊàê
        function isTaskCompleted(courseId, taskId) {
            const submission = loadTaskSubmission(courseId, taskId);
            return submission && submission.completed;
        }

        // Ê£ÄÊü•ÊâÄÊúâ‰ªªÂä°ÊòØÂê¶ÂÆåÊàê
        function areAllTasksCompleted(courseId, tasks) {
            if (!tasks || tasks.length === 0) {
                return true;
            }

            for (const task of tasks) {
                if (!isTaskCompleted(courseId, task.taskId)) {
                    return false;
                }
            }
            return true;
        }

        // ==================== ÊúØËØ≠ÁÆ°ÁêÜÂäüËÉΩ ====================
        // Âä†ËΩΩËØæÁ®ãÊúØËØ≠Êï∞ÊçÆ
        async function loadTermsData(courseId) {
            try {
                const response = await fetch(`http://localhost:3000/api/terms/${courseId}`);
                const data = await response.json();

                if (data.success && data.terms) {
                    state.termsData = data.terms;
                    console.log(`[ÊúØËØ≠] Âä†ËΩΩ‰∫Ü ${data.terms.length} ‰∏™ÊúØËØ≠`);
                    return data.terms;
                } else {
                    console.log('[ÊúØËØ≠] ËØ•ËØæÁ®ãÊöÇÊó†ÊúØËØ≠Êï∞ÊçÆ');
                    return [];
                }
            } catch (error) {
                console.error('[ÊúØËØ≠] Âä†ËΩΩÂ§±Ë¥•:', error);
                return [];
            }
        }

        // Âú®Â≠óÂπïÊñáÊú¨‰∏≠Êü•ÊâæÊúØËØ≠
        function findTermsInText(text) {
            if (!state.termsData || !text) return [];

            const foundTerms = [];
            for (const termData of state.termsData) {
                if (text.includes(termData.term)) {
                    foundTerms.push(termData);
                }
            }
            return foundTerms;
        }

        // ÊòæÁ§∫ÊúØËØ≠
        function displayTerms(terms) {
            const termsSection = document.getElementById('termsSection');
            const termsContainer = document.getElementById('termsContainer');

            if (!termsSection || !termsContainer) return;

            if (terms.length === 0) {
                termsSection.style.display = 'none';
                return;
            }

            termsSection.style.display = 'block';
            termsContainer.innerHTML = '';

            terms.forEach(termData => {
                const termItem = document.createElement('div');
                termItem.className = 'term-item';
                termItem.setAttribute('role', 'article');
                termItem.setAttribute('aria-label', `ÊúØËØ≠: ${termData.term}`);

                termItem.innerHTML = `
                    <div class="term-name">
                        <span>${termData.term}</span>
                        <button class="term-speak-btn"
                                onclick="speakTerm('${termData.term}', '${termData.definition.replace(/'/g, "\\'")}')"
                                aria-label="ÊúóËØªÊúØËØ≠Ëß£Èáä">
                            üîä
                        </button>
                    </div>
                    <div class="term-definition">${termData.definition}</div>
                `;

                termsContainer.appendChild(termItem);
            });

            // Ëá™Âä®ÊúóËØªÁ¨¨‰∏Ä‰∏™ÊúØËØ≠ÔºàËßÜÈöúÊ®°ÂºèÔºâ
            if (state.userMode === 'visual' && terms.length > 0) {
                speakTerm(terms[0].term, terms[0].definition);
            }
        }

        // ËØ≠Èü≥ÊúóËØªÊúØËØ≠
        function speakTerm(term, definition) {
            if ('speechSynthesis' in window) {
                // ÂÅúÊ≠¢ÂΩìÂâçÊúóËØª
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(`ÊúØËØ≠Ôºö${term}„ÄÇËß£ÈáäÔºö${definition}`);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.9;
                utterance.pitch = 1;

                window.speechSynthesis.speak(utterance);
                console.log(`[ÊúØËØ≠] ÊúóËØª: ${term}`);
            }
        }

        // ËÆæÁΩÆÂ≠óÂπïÁõëÂê¨
        function setupTermsTracking() {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoSubtitle = document.getElementById('videoSubtitle');

            if (!videoPlayer || !videoSubtitle) {
                console.log('[ÊúØËØ≠] Êú™ÊâæÂà∞ËßÜÈ¢ëÊí≠ÊîæÂô®ÊàñÂ≠óÂπïËΩ®ÈÅì');
                return;
            }

            // ÁõëÂê¨Â≠óÂπïÂèòÂåñ
            const track = videoSubtitle.track;
            if (track) {
                track.addEventListener('cuechange', () => {
                    const activeCues = track.activeCues;
                    if (activeCues && activeCues.length > 0) {
                        const cueText = activeCues[0].text;
                        const foundTerms = findTermsInText(cueText);

                        if (foundTerms.length > 0) {
                            console.log(`[ÊúØËØ≠] Âú®Â≠óÂπï‰∏≠ÂèëÁé∞ ${foundTerms.length} ‰∏™ÊúØËØ≠:`, foundTerms.map(t => t.term).join(', '));
                            displayTerms(foundTerms);
                            state.currentTerms = foundTerms;
                        } else if (state.currentTerms.length > 0) {
                            // Â¶ÇÊûú‰πãÂâçÊúâÊúØËØ≠ÔºåÁé∞Âú®Ê≤°Êúâ‰∫ÜÔºåÂª∂ËøüÈöêËóè
                            setTimeout(() => {
                                const newCueText = track.activeCues && track.activeCues.length > 0
                                    ? track.activeCues[0].text : '';
                                const newFoundTerms = findTermsInText(newCueText);
                                if (newFoundTerms.length === 0) {
                                    displayTerms([]);
                                    state.currentTerms = [];
                                }
                            }, 3000); // 3ÁßíÂêéÈöêËóè
                        }
                    }
                });

                console.log('[ÊúØËØ≠] Â≠óÂπïÁõëÂê¨Â∑≤ËÆæÁΩÆ');
            }
        }

        // Êõ¥Êñ∞ÂÆåÊàêËØæÁ®ãÊåâÈíÆÁä∂ÊÄÅ
        function updateCompleteCourseButton() {
            const completeCourseBtn = document.getElementById('completeCourseBtn');
            if (!completeCourseBtn || !state.courseData) return;

            const tasks = state.courseData.tasks || [];
            const allCompleted = areAllTasksCompleted(state.courseId, tasks);

            if (allCompleted) {
                completeCourseBtn.disabled = false;
                completeCourseBtn.setAttribute('aria-disabled', 'false');
                completeCourseBtn.style.opacity = '1';
            } else {
                completeCourseBtn.disabled = true;
                completeCourseBtn.setAttribute('aria-disabled', 'true');
                completeCourseBtn.style.opacity = '0.5';
                completeCourseBtn.title = 'ËØ∑ÂÆåÊàêÊâÄÊúâ‰ªªÂä°ÂêéÂÜçÁÇπÂáªÂÆåÊàêËØæÁ®ã';
            }
        }

        // ==================== ËøîÂõûÊåâÈíÆÂäüËÉΩ ====================
        const returnBtn = document.getElementById('returnBtn');
        returnBtn.addEventListener('click', () => {
            window.location.href = `course_selection.html?mode=${state.userMode}`;
        });

        // ==================== ÂÆåÊàêËØæÁ®ãÊåâÈíÆÂäüËÉΩ ====================
        const completeCourseBtn = document.getElementById('completeCourseBtn');
        completeCourseBtn.addEventListener('click', async () => {
            if (!state.courseId) {
                showNotification('ËØæÁ®ãIDÊó†Êïà', 'error');
                return;
            }

            try {
                // ‰øùÂ≠òÂÆåÊàêÁä∂ÊÄÅÂà∞localStorage
                const completedCourses = JSON.parse(localStorage.getItem('completedCourses') || '[]');
                if (!completedCourses.includes(state.courseId)) {
                    completedCourses.push(state.courseId);
                    localStorage.setItem('completedCourses', JSON.stringify(completedCourses));
                }

                // ÂèëÈÄÅÂÆåÊàêÊï∞ÊçÆÂà∞ÂêéÁ´Ø
                const response = await fetch('http://localhost:3000/api/course-completion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        courseId: state.courseId,
                        completedAt: new Date().toISOString(),
                        userMode: state.userMode
                    })
                });

                if (response.ok) {
                    showNotification('ËØæÁ®ãÂ∑≤ÂÆåÊàêÔºÅ', 'success');
                    // Âª∂ËøüË∑≥ËΩ¨ÔºåËÆ©Áî®Êà∑ÁúãÂà∞ÊàêÂäüÊ∂àÊÅØ
                    setTimeout(() => {
                        window.location.href = `course_selection.html?mode=${state.userMode}`;
                    }, 1000);
                } else {
                    // Âç≥‰ΩøÂêéÁ´ØÂ§±Ë¥•Ôºå‰πü‰øùÂ≠òÊú¨Âú∞Áä∂ÊÄÅÂπ∂Ë∑≥ËΩ¨
                    showNotification('ËØæÁ®ãÂ∑≤ÂÆåÊàêÔºàÊú¨Âú∞‰øùÂ≠òÔºâ', 'success');
                    setTimeout(() => {
                        window.location.href = `course_selection.html?mode=${state.userMode}`;
                    }, 1000);
                }
            } catch (error) {
                console.error('ÂÆåÊàêËØæÁ®ãÂ§±Ë¥•:', error);
                // Âç≥‰ΩøÂá∫ÈîôÔºå‰πü‰øùÂ≠òÊú¨Âú∞Áä∂ÊÄÅÂπ∂Ë∑≥ËΩ¨
                showNotification('ËØæÁ®ãÂ∑≤ÂÆåÊàêÔºàÊú¨Âú∞‰øùÂ≠òÔºâ', 'success');
                setTimeout(() => {
                    window.location.href = `course_selection.html?mode=${state.userMode}`;
                }, 1000);
            }
        });

        // ==================== Âä†ËΩΩËØæÁ®ãÊï∞ÊçÆ ====================
        async function loadCourseData() {
            if (!state.courseId) {
                showNotification('Êú™ÊåáÂÆöËØæÁ®ãID', 'error');
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:3000/api/courses/${state.courseId}`);
                const result = await response.json();
                
                if (result.success && result.course) {
                    state.courseData = result.course;
                    renderCourseInfo();
                    renderTasks();
                    updateProgress();
                    updateCompleteCourseButton();

                    // Âä†ËΩΩÊúØËØ≠Êï∞ÊçÆ
                    loadTermsData(state.courseId).then(terms => {
                        if (terms.length > 0) {
                            console.log(`[ÊúØËØ≠] ÊàêÂäüÂä†ËΩΩ ${terms.length} ‰∏™ÊúØËØ≠`);
                        }
                    });
                } else {
                    showNotification('Âä†ËΩΩËØæÁ®ãÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('Âä†ËΩΩËØæÁ®ãÂ§±Ë¥•:', error);
                showNotification('Âä†ËΩΩËØæÁ®ãÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°', 'error');
            }
        }
        
        // ==================== Ê∏≤ÊüìËØæÁ®ã‰ø°ÊÅØ ====================
        function renderCourseInfo() {
            document.getElementById('courseTitle').textContent = state.courseData.title;
            document.getElementById('courseTitleMain').textContent = state.courseData.title;
            document.getElementById('courseDescription').textContent = state.courseData.description;

            // Ê£ÄÊµãÊòØÂê¶ÊúâËßÜÈ¢ë
            if (state.courseData.videoUrl && state.courseData.videoUrl.trim() !== '') {
                const videoSection = document.getElementById('videoSection');
                const videoSource = document.getElementById('videoSource');
                const videoPlayer = document.getElementById('videoPlayer');
                const videoSubtitle = document.getElementById('videoSubtitle');

                // Áõ¥Êé•ËßÜÈ¢ëÊñá‰ª∂Ôºå‰ΩøÁî®videoÊ†áÁ≠æ
                videoSource.src = state.courseData.videoUrl;

                // ËÆæÁΩÆÂ≠óÂπïÊ∫êÔºàÂ§ÑÁêÜCORSÈîôËØØÔºâ
                if (state.courseData.subtitleUrl) {
                    let subtitleUrl = state.courseData.subtitleUrl;
                    if (!subtitleUrl.startsWith('http://') && !subtitleUrl.startsWith('https://')) {
                        subtitleUrl = `http://localhost:3000/${subtitleUrl}`;
                    }
                    videoSubtitle.src = subtitleUrl;

                    videoSubtitle.addEventListener('error', function() {
                        console.warn('Â≠óÂπïÂä†ËΩΩÂ§±Ë¥•ÔºàÂèØËÉΩÊòØCORSÈóÆÈ¢òÔºâÔºö', subtitleUrl);
                    }, { once: true });

                    // Â≠óÂπïÂä†ËΩΩÊàêÂäüÂêéËÆæÁΩÆÊúØËØ≠ÁõëÂê¨
                    videoSubtitle.addEventListener('load', function() {
                        console.log('[ÊúØËØ≠] Â≠óÂπïÂä†ËΩΩÊàêÂäüÔºåËÆæÁΩÆÊúØËØ≠ÁõëÂê¨');
                        setupTermsTracking();
                    }, { once: true });
                }

                // ÁõëÂê¨ËßÜÈ¢ëÂä†ËΩΩÈîôËØØ
                videoPlayer.addEventListener('error', function() {
                    const error = videoPlayer.error;
                    if (error && error.code === error.MEDIA_ERR_SRC_NOT_SUPPORTED) {
                        showNotification('ËßÜÈ¢ëÊ†ºÂºè‰∏çÊîØÊåÅÊàñÈìæÊé•Êó†Êïà', 'error');
                    }
                }, { once: true });

                videoPlayer.load();

                // ÊòæÁ§∫ËßÜÈ¢ëÊí≠ÊîæÂô®
                videoSection.classList.add('visible');

                // ÂàùÂßãÂåñËßÜÈ¢ëÊéßÂà∂
                initVideoControls();
            }
        }

        // ==================== ÂàùÂßãÂåñËßÜÈ¢ëÊéßÂà∂ ====================
        function initVideoControls() {
            const videoPlayer = document.getElementById('videoPlayer');
            const showSubtitleBtn = document.getElementById('showSubtitleBtn');
            const hideSubtitleBtn = document.getElementById('hideSubtitleBtn');
            const subtitleSizeSlider = document.getElementById('subtitleSizeSlider');
            const subtitleSizeValue = document.getElementById('subtitleSizeValue');

            // Á≠âÂæÖËßÜÈ¢ëÂÖÉÊï∞ÊçÆÂä†ËΩΩÂÆåÊàêÂêéÂÜçÂàùÂßãÂåñÂ≠óÂπïÊéßÂà∂
            const setupSubtitleControls = () => {
                // ==================== Â≠óÂπïÊéßÂà∂ ====================
                const videoTrack = videoPlayer.textTracks[0];

                // ÈªòËÆ§ÊòæÁ§∫Â≠óÂπï
                if (videoTrack) {
                    videoTrack.mode = 'showing';
                    console.log('Â≠óÂπïËΩ®ÈÅìÂ∑≤Âä†ËΩΩÂπ∂ËÆæÁΩÆ‰∏∫ÊòæÁ§∫Ê®°Âºè');
                } else {
                    console.warn('Êú™ÊâæÂà∞Â≠óÂπïËΩ®ÈÅì');
                }

                // Â≠óÂπïÊéßÂà∂ÊåâÈíÆÔºà‰ªÖÂê¨ÈöúÊ®°ÂºèÔºâ
                if (state.userMode === 'hearing' && showSubtitleBtn && hideSubtitleBtn && subtitleSizeSlider) {
                    // ÊòæÁ§∫Â≠óÂπïÊåâÈíÆ
                    showSubtitleBtn.addEventListener('click', () => {
                        const track = videoPlayer.textTracks[0];
                        if (track) {
                            track.mode = 'showing';
                            showSubtitleBtn.classList.add('active');
                            hideSubtitleBtn.classList.remove('active');
                        }
                    });

                    // ÈöêËóèÂ≠óÂπïÊåâÈíÆ
                    hideSubtitleBtn.addEventListener('click', () => {
                        const track = videoPlayer.textTracks[0];
                        if (track) {
                            track.mode = 'hidden';
                            hideSubtitleBtn.classList.add('active');
                            showSubtitleBtn.classList.remove('active');
                        }
                    });

                // Â≠óÂπïÂ§ßÂ∞èË∞ÉËäÇ
                subtitleSizeSlider.addEventListener('input', (e) => {
                    const size = parseInt(e.target.value);
                    subtitleSizeValue.textContent = size;

                    // ÈÄöËøáCSSÂèòÈáèÊéßÂà∂Â≠óÂπïÂ§ßÂ∞è
                    const style = document.createElement('style');
                    style.id = 'subtitle-size-style';
                    const existingStyle = document.getElementById('subtitle-size-style');
                    if (existingStyle) {
                        existingStyle.remove();
                    }
                    style.textContent = `
                        video::cue {
                            font-size: ${size}px !important;
                        }
                    `;
                    document.head.appendChild(style);
                });
            }
            };

            // Â¶ÇÊûúËßÜÈ¢ëÂ∑≤ÁªèÂä†ËΩΩ‰∫ÜÂÖÉÊï∞ÊçÆÔºåÁõ¥Êé•ÂàùÂßãÂåñ
            if (videoPlayer.readyState >= 1) {
                setupSubtitleControls();
            } else {
                // Âê¶ÂàôÁ≠âÂæÖÂÖÉÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê
                videoPlayer.addEventListener('loadedmetadata', setupSubtitleControls, { once: true });
            }
        }


        // ==================== Ê∏≤Êüì‰ªªÂä°ÂàóË°® ====================
        function renderTasks() {
            const taskSection = document.getElementById('taskSection');
            taskSection.innerHTML = '';
            taskSection.setAttribute('role', 'list');
            taskSection.setAttribute('aria-label', 'Â≠¶‰π†‰ªªÂä°ÂàóË°®');

            if (!state.courseData.tasks || state.courseData.tasks.length === 0) {
                taskSection.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ÊöÇÊó†‰ªªÂä°</p>';
                return;
            }

            state.courseData.tasks.forEach((task, index) => {
                const taskCard = createTaskCard(task, index + 1);
                taskSection.appendChild(taskCard);
            });
        }
        
        // ==================== ÂàõÂª∫‰ªªÂä°Âç°Áâá - Á∫øÊÄßÂ∏ÉÂ±Ä ====================
        function createTaskCard(task, taskNumber) {
            const article = document.createElement('article');
            article.className = 'task-card';
            article.id = `task${taskNumber}`;
            article.dataset.taskId = task.taskId;
            article.setAttribute('role', 'listitem');
            article.setAttribute('aria-label', `‰ªªÂä°${taskNumber}Ôºö${task.taskTitle || '‰ªªÂä°' + taskNumber}`);

            // Á¨¨‰∏Ä‰∏™‰ªªÂä°ÈªòËÆ§ÊøÄÊ¥ª
            if (taskNumber === 1) {
                article.classList.add('active');
            }

            // ‰ªªÂä°Ê†áÈ¢òÔºà‰ΩøÁî®h2Ê†áÁ≠æÔºåÊõ¥Â•ΩÁöÑËØ≠‰πâÔºâ
            const title = document.createElement('h2');
            title.className = 'task-title';
            title.innerHTML = `<span aria-hidden="true">${taskNumber}. </span>${task.taskTitle || '‰ªªÂä°' + taskNumber}`;

            // ‰ªªÂä°ÊèèËø∞
            const description = document.createElement('p');
            description.className = 'task-description';
            description.textContent = task.taskDescription || 'ÊöÇÊó†ÊèèËø∞';

            // Â¶ÇÊûúÊúâAIÂ∑•ÂÖ∑ÈìæÊé•ÔºåÊòæÁ§∫ÊèêÁ§∫
            let aiHint = null;
            if (task.taskParams && task.taskParams.aiPlatform) {
                aiHint = document.createElement('p');
                aiHint.className = 'task-ai-hint';
                aiHint.innerHTML = `<span aria-hidden="true">üí°</span> Âª∫ËÆÆ‰ΩøÁî®Ôºö${task.taskParams.aiPlatform}`;
            }

            // ‰ªªÂä°Êìç‰ΩúÊåâÈíÆÁªÑ
            const actions = document.createElement('div');
            actions.className = 'task-actions';
            actions.setAttribute('role', 'group');
            actions.setAttribute('aria-label', '‰ªªÂä°Êìç‰Ωú');

            const startBtn = document.createElement('button');
            startBtn.className = 'btn btn-primary';
            startBtn.dataset.action = 'start';
            startBtn.textContent = 'ÂºÄÂßã‰ªªÂä°';
            startBtn.setAttribute('aria-label', `ÂºÄÂßã‰ªªÂä°${taskNumber}Ôºö${task.taskTitle || '‰ªªÂä°' + taskNumber}`);

            // Ê£ÄÊü•Ââç‰∏Ä‰∏™‰ªªÂä°ÊòØÂê¶ÂÆåÊàêÔºàÈÄöËøáÊ£ÄÊü•ÊòØÂê¶ÊúâÊèê‰∫§ÂÜÖÂÆπÔºâ
            const prevTaskId = `task${taskNumber - 1}`;
            const prevTaskCompleted = taskNumber === 1 || isTaskCompleted(state.courseId, prevTaskId);
            if (!prevTaskCompleted) {
                startBtn.disabled = true;
                startBtn.setAttribute('aria-disabled', 'true');
            }

            actions.appendChild(startBtn);

            // ‰ªªÂä°Êèê‰∫§Âå∫Âüü
            const submissionArea = document.createElement('div');
            submissionArea.className = 'task-submission-area';

            const submissionLabel = document.createElement('label');
            submissionLabel.className = 'task-submission-label';

            // Ê†πÊçÆÊèê‰∫§Á±ªÂûãÊòæÁ§∫‰∏çÂêåÁöÑÊ†áÁ≠æÂíåËæìÂÖ•ÊñπÂºè
            const submissionType = task.taskParams?.submissionType || 'text';
            let submissionInput;

            switch(submissionType) {
                case 'text':
                    submissionLabel.textContent = '‰ªªÂä°Êèê‰∫§ÔºàÊñáÂ≠óÔºâÔºö';
                    submissionLabel.setAttribute('for', `submission-${task.taskId}`);

                    submissionInput = document.createElement('textarea');
                    submissionInput.className = 'task-submission-textarea';
                    submissionInput.id = `submission-${task.taskId}`;
                    submissionInput.placeholder = 'ËØ∑Âú®Ê≠§Â§ÑËæìÂÖ•ÊÇ®ÁöÑ‰ªªÂä°ÂÆåÊàêÂÜÖÂÆπ...';
                    submissionInput.setAttribute('aria-label', `‰ªªÂä°${taskNumber}Êèê‰∫§ÂÜÖÂÆπËæìÂÖ•Ê°Ü`);
                    break;

                case 'image':
                    submissionLabel.textContent = '‰ªªÂä°Êèê‰∫§ÔºàÂõæÁâáÔºâÔºö';
                    submissionLabel.setAttribute('for', `submission-${task.taskId}`);

                    submissionInput = document.createElement('input');
                    submissionInput.type = 'file';
                    submissionInput.accept = 'image/*';
                    submissionInput.className = 'task-submission-textarea';
                    submissionInput.id = `submission-${task.taskId}`;
                    submissionInput.setAttribute('aria-label', `‰ªªÂä°${taskNumber}ÂõæÁâá‰∏ä‰º†`);
                    break;

                case 'video':
                    submissionLabel.textContent = '‰ªªÂä°Êèê‰∫§ÔºàËßÜÈ¢ëÔºâÔºö';
                    submissionLabel.setAttribute('for', `submission-${task.taskId}`);

                    submissionInput = document.createElement('input');
                    submissionInput.type = 'file';
                    submissionInput.accept = 'video/*';
                    submissionInput.className = 'task-submission-textarea';
                    submissionInput.id = `submission-${task.taskId}`;
                    submissionInput.setAttribute('aria-label', `‰ªªÂä°${taskNumber}ËßÜÈ¢ë‰∏ä‰º†`);
                    break;

                case 'file':
                    submissionLabel.textContent = '‰ªªÂä°Êèê‰∫§ÔºàÊñá‰ª∂ÔºâÔºö';
                    submissionLabel.setAttribute('for', `submission-${task.taskId}`);

                    submissionInput = document.createElement('input');
                    submissionInput.type = 'file';
                    submissionInput.className = 'task-submission-textarea';
                    submissionInput.id = `submission-${task.taskId}`;
                    submissionInput.setAttribute('aria-label', `‰ªªÂä°${taskNumber}Êñá‰ª∂‰∏ä‰º†`);
                    break;

                default:
                    submissionLabel.textContent = '‰ªªÂä°Êèê‰∫§Ôºö';
                    submissionLabel.setAttribute('for', `submission-${task.taskId}`);

                    submissionInput = document.createElement('textarea');
                    submissionInput.className = 'task-submission-textarea';
                    submissionInput.id = `submission-${task.taskId}`;
                    submissionInput.placeholder = 'ËØ∑Âú®Ê≠§Â§ÑËæìÂÖ•ÊÇ®ÁöÑ‰ªªÂä°ÂÆåÊàêÂÜÖÂÆπ...';
                    submissionInput.setAttribute('aria-label', `‰ªªÂä°${taskNumber}Êèê‰∫§ÂÜÖÂÆπËæìÂÖ•Ê°Ü`);
            }

            const submitBtn = document.createElement('button');
            submitBtn.className = 'task-submit-btn';
            submitBtn.textContent = 'Êèê‰∫§‰ªªÂä°';
            submitBtn.setAttribute('aria-label', `Êèê‰∫§‰ªªÂä°${taskNumber}`);

            const statusDiv = document.createElement('div');
            statusDiv.className = 'task-status pending';
            statusDiv.id = `status-${task.taskId}`;
            statusDiv.textContent = 'Êú™ÂÆåÊàê';
            statusDiv.setAttribute('role', 'status');
            statusDiv.setAttribute('aria-live', 'polite');

            submissionArea.appendChild(submissionLabel);
            submissionArea.appendChild(submissionInput);
            submissionArea.appendChild(submitBtn);
            submissionArea.appendChild(statusDiv);

            // ÁªÑË£ÖÂç°Áâá - Á∫øÊÄßÈ°∫Â∫è
            article.appendChild(title);
            article.appendChild(description);
            if (aiHint) {
                article.appendChild(aiHint);
            }
            article.appendChild(actions);
            article.appendChild(submissionArea);

            // Âä†ËΩΩ‰πãÂâç‰øùÂ≠òÁöÑÊèê‰∫§ÂÜÖÂÆπ
            const savedSubmission = loadTaskSubmission(state.courseId, task.taskId);
            if (savedSubmission) {
                if (submissionType === 'text') {
                    submissionInput.value = savedSubmission.content;
                }
                if (savedSubmission.completed) {
                    statusDiv.className = 'task-status completed';
                    statusDiv.textContent = '‚úì Â∑≤ÂÆåÊàê';
                    article.classList.add('completed');
                }
            }

            // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨
            startBtn.addEventListener('click', () => handleTaskStart(taskNumber, task));

            // Êèê‰∫§ÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨
            submitBtn.addEventListener('click', () => {
                let content = '';

                // Ê†πÊçÆÊèê‰∫§Á±ªÂûãËé∑ÂèñÂÜÖÂÆπ
                if (submissionType === 'text') {
                    content = submissionInput.value.trim();
                } else {
                    // ÂØπ‰∫éÊñá‰ª∂Á±ªÂûãÔºåËé∑ÂèñÊñá‰ª∂Âêç
                    const file = submissionInput.files[0];
                    if (file) {
                        content = `Â∑≤‰∏ä‰º†Êñá‰ª∂: ${file.name}`;
                    }
                }

                if (content.length === 0) {
                    showNotification('ËØ∑ÂÆåÊàê‰ªªÂä°Êèê‰∫§', 'error');
                    return;
                }

                // ‰øùÂ≠òÊèê‰∫§ÂÜÖÂÆπ
                saveTaskSubmission(state.courseId, task.taskId, content);

                // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
                statusDiv.className = 'task-status completed';
                statusDiv.textContent = '‚úì Â∑≤ÂÆåÊàê';
                article.classList.add('completed');

                // Ë∞ÉÁî®‰ªªÂä°ÂÆåÊàêÂ§ÑÁêÜÔºåÊøÄÊ¥ª‰∏ã‰∏Ä‰∏™‰ªªÂä°
                handleTaskComplete(taskNumber);

                // Êõ¥Êñ∞ÂÆåÊàêËØæÁ®ãÊåâÈíÆÁä∂ÊÄÅ
                updateCompleteCourseButton();

                showNotification(`‰ªªÂä°${taskNumber}Â∑≤Êèê‰∫§`, 'success');
            });

            return article;
        }
        
        // ==================== ‰ªªÂä°‰∫§‰∫íÂ§ÑÁêÜ ====================
        function handleTaskStart(taskNumber, task) {
            showNotification(`‰ªªÂä°${taskNumber}Â∑≤ÂºÄÂßã`, 'info');

            // Â¶ÇÊûúÊúâAIÂ∑•ÂÖ∑ÈìæÊé•ÔºåÂèØ‰ª•Âú®ËøôÈáåÊâìÂºÄ
            if (task.taskParams && task.taskParams.aiPlatform) {
                const aiLinks = state.courseData.aiToolLinks || [];
                const aiLink = aiLinks.find(link => link.name === task.taskParams.aiPlatform);
                if (aiLink) {
                    const shouldOpen = confirm(`ÊòØÂê¶ÊâìÂºÄ${task.taskParams.aiPlatform}Ôºü\n\nÊèêÁ§∫ËØçÊ®°ÊùøÔºö${task.taskParams.promptTemplate || 'Êó†'}`);
                    if (shouldOpen) {
                        window.open(aiLink.url, '_blank');
                    }
                }
            }

            // ‰ªªÂä°ÈúÄË¶ÅÂ≠¶ÂëòÊèê‰∫§ÂÜÖÂÆπÂêéÊâçËÉΩÂÆåÊàêÔºå‰∏çÂÜçËá™Âä®ÂÆåÊàê
        }
        
        function handleTaskComplete(taskNumber) {
            if (!state.completedTasks.includes(taskNumber)) {
                state.completedTasks.push(taskNumber);

                const taskCard = document.getElementById(`task${taskNumber}`);
                taskCard.classList.add('completed');
                taskCard.classList.remove('active');

                updateProgress();
                showNotification(`‰ªªÂä°${taskNumber}Â∑≤ÂÆåÊàêÔºÅ`, 'success');

                // ÊøÄÊ¥ª‰∏ã‰∏Ä‰∏™‰ªªÂä°
                const totalTasks = state.courseData.tasks.length;
                if (taskNumber < totalTasks) {
                    activateNextTask(taskNumber + 1);
                } else {
                    const finalMessage = 'ÊÅ≠ÂñúÔºÅÊÇ®Â∑≤ÂÆåÊàêÊâÄÊúâÂ≠¶‰π†‰ªªÂä°ÔºÅ';
                    showNotification(finalMessage, 'success');
                }
            }
        }
        
        function activateNextTask(taskNumber) {
            state.currentTask = taskNumber;
            const taskCard = document.getElementById(`task${taskNumber}`);
            taskCard.classList.add('active');
            
            const startBtn = taskCard.querySelector('[data-action="start"]');
            if (startBtn) {
                startBtn.disabled = false;
            }
            
            taskCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // ==================== ËøõÂ∫¶Êõ¥Êñ∞ ====================
        function updateProgress() {
            const totalTasks = state.courseData.tasks.length;
            const completed = state.completedTasks.length;
            const percentage = totalTasks > 0 ? Math.round((completed / totalTasks) * 100) : 0;
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
            progressBar.parentElement.setAttribute('aria-valuenow', percentage);
            
            progressText.textContent = `Â∑≤ÂÆåÊàê ${completed}/${totalTasks} ‰∏™‰ªªÂä°`;
        }

        // ==================== ÈÄöÁü•Á≥ªÁªü ====================
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'assertive');
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // ==================== È°µÈù¢ÂàùÂßãÂåñ ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Âä†ËΩΩËØæÁ®ãÊï∞ÊçÆ
            loadCourseData();

            // ÈîÆÁõòÂØºËà™ÊîØÊåÅ
            document.addEventListener('keydown', (e) => {
                // Escape - ËøîÂõû
                if (e.key === 'Escape') {
                    returnBtn.click();
                }
            });

            // ÂàùÂßãÂåñËøõÂ∫¶Ë∑üË∏™
            initProgressTracking();

        });

        // ==================== Â≠¶ÁîüËøõÂ∫¶Ë∑üË∏™ ====================
        function initProgressTracking() {
            // Ëé∑ÂèñÂ≠¶ÁîüIDÔºà‰ªéÁôªÂΩïÁî®Êà∑‰ø°ÊÅØËé∑ÂèñÔºâ
            const urlParams = new URLSearchParams(window.location.search);
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const studentId = currentUser ? currentUser.id : 'student_001';
            const courseId = urlParams.get('courseId');

            if (!courseId) return;

            // ÁõëÂê¨‰ªªÂä°Âç°ÁâáÁÇπÂáª‰∫ã‰ª∂
            document.addEventListener('click', async (e) => {
                const taskCard = e.target.closest('.task-card');
                if (taskCard) {
                    const taskNumber = parseInt(taskCard.id.replace('task', ''));
                    const taskIndex = taskNumber - 1;

                    // Êõ¥Êñ∞ËøõÂ∫¶
                    await updateStudentProgress(studentId, courseId, taskIndex, 'visit');
                }
            });

            // ÁõëÂê¨‰ªªÂä°Êèê‰∫§ÊåâÈíÆ
            document.addEventListener('click', async (e) => {
                if (e.target.classList.contains('task-submit-btn')) {
                    const taskCard = e.target.closest('.task-card');
                    if (taskCard) {
                        const taskNumber = parseInt(taskCard.id.replace('task', ''));
                        const taskIndex = taskNumber - 1;

                        // Ê†áËÆ∞‰ªªÂä°ÂÆåÊàê
                        await updateStudentProgress(studentId, courseId, taskIndex, 'complete');
                    }
                }
            });
        }

        // Êõ¥Êñ∞Â≠¶ÁîüËøõÂ∫¶
        async function updateStudentProgress(studentId, courseId, taskIndex, action) {
            try {
                const response = await fetch('http://localhost:3000/api/progress/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        studentId: studentId,
                        courseId: courseId,
                        taskIndex: taskIndex,
                        action: action
                    })
                });

                const data = await response.json();
                if (data.success) {
                    console.log('ËøõÂ∫¶Â∑≤Êõ¥Êñ∞:', data.progress);
                }
            } catch (error) {
                console.error('Êõ¥Êñ∞ËøõÂ∫¶Â§±Ë¥•:', error);
            }
        }
    </script>
</body>
</html>
